<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <th:block th:replace="~{fragments/common-head :: head-elements(pageTitle='시각적 정책 빌더')}"></th:block>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        .palette-item { cursor: pointer; transition: background-color 0.2s; }
        .palette-item:hover { background-color: #f3f4f6; }
        .canvas-zone { min-height: 8rem; border-style: dashed; }
        .policy-chip { animation: popIn 0.3s ease-out; }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-gray-100">

<div th:insert="~{fragments/header :: header}"></div>

<div class="flex-1 p-6">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">시각적 정책 빌더</h1>

        <div class="grid grid-cols-12 gap-6">

            <div class="col-span-3 space-y-4">
                <div class="bg-white rounded-lg shadow p-4">
                    <h3 class="font-bold text-lg">주체 (Who)</h3>
                    <input type="search" placeholder="사용자/그룹 검색..." class="w-full my-2 p-2 border rounded">
                    <div id="subjects-palette" class="max-h-60 overflow-y-auto">
                        <div th:each="user : ${allUsers}" class="palette-item p-2 rounded" data-type="subject" th:data-info="${'USER:' + user.id + ':' + user.name}">
                            <i class="fas fa-user mr-2 text-gray-500"></i> <span th:text="${user.name}"></span>
                        </div>
                        <div th:each="group : ${allGroups}" class="palette-item p-2 rounded" data-type="subject" th:data-info="${'GROUP:' + group.id + ':' + group.name}">
                            <i class="fas fa-users mr-2 text-gray-500"></i> <span th:text="${group.name}"></span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <h3 class="font-bold text-lg">권한 (What)</h3>
                    <input type="search" placeholder="권한 검색..." class="w-full my-2 p-2 border rounded">
                    <div id="permissions-palette" class="max-h-60 overflow-y-auto">
                        <div th:each="perm : ${allPermissions}" class="palette-item p-2 rounded" data-type="permission" th:data-info="${perm.id + ':' + perm.description}">
                            <i class="fas fa-key mr-2 text-gray-500"></i> <span th:text="${perm.description}"></span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <h3 class="font-bold text-lg">조건 (When)</h3>
                    <div id="conditions-palette" class="max-h-60 overflow-y-auto">
                        <div th:each="cond : ${allConditions}" class="palette-item p-2 rounded" data-type="condition" th:data-info="${cond.id + ':' + cond.name}">
                            <i class="fas fa-clock mr-2 text-gray-500"></i> <span th:text="${cond.name}"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-span-6 bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold mb-4">정책 구성</h2>
                <div class="space-y-6">
                    <div>
                        <label class="font-semibold text-gray-700">이 주체들이 (IF)</label>
                        <div id="subjects-canvas" class="canvas-zone mt-2 p-4 bg-gray-50 border-2 border-gray-200 rounded-lg flex flex-wrap gap-2">
                            <span class="text-gray-400">왼쪽에서 주체를 선택하세요.</span>
                        </div>
                    </div>
                    <div>
                        <label class="font-semibold text-gray-700">이러한 권한으로 (WHAT)</label>
                        <div id="permissions-canvas" class="canvas-zone mt-2 p-4 bg-gray-50 border-2 border-gray-200 rounded-lg flex flex-wrap gap-2">
                            <span class="text-gray-400">왼쪽에서 권한을 선택하세요.</span>
                        </div>
                    </div>
                    <div>
                        <label class="font-semibold text-gray-700">아래 조건이 만족될 때 (WHEN)</label>
                        <div id="conditions-canvas" class="canvas-zone mt-2 p-4 bg-gray-50 border-2 border-gray-200 rounded-lg flex flex-wrap gap-2">
                            <span class="text-gray-400">왼쪽에서 조건을 선택하세요.</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-span-3 bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold mb-4">속성 및 저장</h2>
                <div class="space-y-4">
                    <div>
                        <label for="policy-name" class="font-semibold text-gray-700">정책 이름</label>
                        <input type="text" id="policy-name" class="w-full mt-1 p-2 border rounded-md" placeholder="예: 영업팀 보고서 접근 정책">
                    </div>
                    <div>
                        <label for="policy-desc" class="font-semibold text-gray-700">설명</label>
                        <textarea id="policy-desc" class="w-full mt-1 p-2 border rounded-md" rows="3"></textarea>
                    </div>
                    <div>
                        <label class="font-semibold text-gray-700">효과</label>
                        <select id="policy-effect" class="w-full mt-1 p-2 border rounded-md">
                            <option value="ALLOW">허용 (ALLOW)</option>
                            <option value="DENY">거부 (DENY)</option>
                        </select>
                    </div>
                    <div class="border-t pt-4">
                        <h3 class="font-semibold text-gray-700">실시간 미리보기</h3>
                        <div id="policy-preview" class="mt-2 p-3 bg-indigo-50 text-indigo-800 text-sm rounded-md h-24"></div>
                    </div>
                    <div>
                        <button id="save-policy-btn" class="w-full py-3 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition">
                            <i class="fas fa-save mr-2"></i> 정책 저장하기
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script th:src="@{/js/policy-builder.js}"></script>
</body>
</html>